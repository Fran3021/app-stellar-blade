{% extends "general/layout.html" %}
{% load crispy_forms_tags %}
{% block head_title %}Stellar Blade{% endblock  %}
{% block page_title %}Conversaciones{% endblock  %}
{% block page_content %}
<div class="container-conversaciones">
    <h4>{{conversacion}}</h4>
    {% for mensajes in conversacion.mensajes.all %}
    {% if mensajes.autor == request.user.perfil %}
        <div class="mensaje-1">
            <img src="{{mensajes.autor.imagen_perfil.thumbnails.small.url}}" alt="" class="imagen-perfil-usuario">
            <p>{{mensajes.contenido}}</p>
            <span>Hace: {{mensajes.fecha_mensaje | timesince}}</span>
            {% if request.user.perfil == mensajes.autor %}
            <button data-href="{% url 'mensajes:eliminar_mensaje' mensajes.pk %}" class="eliminar-mensajes" data-mensaje-pk="{{mensajes.pk}}" id="eliminar-mensaje-{{mensajes.pk}}"><i class="bi bi-trash3"></i></button>
            {% endif %}
        </div>
    {% else %}
    <div class="mensaje-2">
        {% if request.user.perfil == mensajes.autor %}
        <button data-href="{% url 'mensajes:eliminar_mensaje' mensajes.pk %}" class="eliminar-mensajes" data-mensaje-pk="{{mensajes.pk}}" id="eliminar-mensaje-{{mensajes.pk}}"><i class="bi bi-trash3"></i></button>
        {% endif %}
        <span>Hace: {{mensajes.fecha_mensaje | timesince}}</span>
        <p>{{mensajes.contenido}}</p>
        <img src="{{mensajes.autor.imagen_perfil.thumbnails.small.url}}" alt="" class="imagen-perfil-usuario">
    </div>
    {% endif %}
    {% endfor %}
    {% if conversacion.mensajes.all %}
        <form class="form-contestar-mensaje" action="{% url 'mensajes:contestar_mensaje' conversacion.mensajes.last.pk %}" method='POST'>
            {% csrf_token %}
            {{contestar_mensaje.contenido | as_crispy_field}}
            <button class="boton-contestar">contestar</button>
        </form>
    {% else %}
        <h5>Se han borrado los mensajes de esta conversacion</h5>
        <button data-href="{% url 'mensajes:eliminar_conversacion' conversacion.pk %}" class="eliminar-conversaciones" data-conversacion-pk="{{conversacion.pk}}" id="eliminar-conversacion-{{conversacion.pk}}" >Eliminar conversacion</button>
    {% endif %}
</div>
{% endblock  %}
